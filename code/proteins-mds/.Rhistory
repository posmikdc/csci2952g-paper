prot_dict <-
read_tsv("../../data/gao_shs27k_data/protein.SHS27k.sequences.dictionary.pro3.tsv",
col_names = c("string_id", "seq"))
# Uniprot Crosswalk ============================================================
# Remove species prefix for STRING API
proteins <- sub("^9606\\.", "", prot_dict$string_id)
# Query STRING API
url <- "https://string-db.org/api/json/get_string_ids"
response <- POST(url,
body = list(identifiers = paste(proteins, collapse = "\n"),
species = 9606,
limit = 1))
# Parse results
prot_xwalk <- content(response, "text") %>% fromJSON()
# Save the Crosswalk ===========================================================
# Save the XWalk
write_csv(prot_xwalk, "../../output/proteins-mds/prot_crosswalk.csv")
################################################################################
### Title: Download Protein Structure
### Author: Daniel Posmik (daniel_posmik@brown.edu)
################################################################################
# Setup ========================================================================
# Environment
#install.packages(c("bio3d", "smacof", "rbioapi"))
library(bio3d)
library(smacof)
library(readr)
library(tidyverse)
library(rbioapi)
library(httr)
library(jsonlite)
#setwd("/Users/posmikdc/Documents/brown/classes/year2/fall25/csci2952g-dlgenomics/csci2952g-paper/code/proteins-mds")
# Read in crosswalk
prot_xwalk <- read_csv("../../output/proteins-mds/prot_crosswalk.csv")
rm(list=ls())
################################################################################
### Title: Download Protein Structure
### Author: Daniel Posmik (daniel_posmik@brown.edu)
################################################################################
# Setup ========================================================================
# Environment
#install.packages(c("bio3d", "smacof", "rbioapi"))
library(bio3d)
library(smacof)
library(readr)
library(tidyverse)
library(rbioapi)
library(httr)
library(jsonlite)
#setwd("/Users/posmikdc/Documents/brown/classes/year2/fall25/csci2952g-dlgenomics/csci2952g-paper/code/proteins-mds")
# Read in crosswalk
prot_xwalk <- read_csv("../../output/proteins-mds/prot_crosswalk.csv")
View(prot_xwalk)
# Obtain 3D protein files ======================================================
# Test with first 5 gene names
test_genes <- results$preferredName[1:5]
# Obtain 3D protein files ======================================================
# Test with first 5 gene names
test_genes <- prot_xwalk$preferredName[1:5]
# Query UniProt API to get accession IDs
uniprot_url <- "https://rest.uniprot.org/idmapping/run"
job_response <- POST(uniprot_url,
body = list(ids = paste(test_genes, collapse = ","),
from = "Gene_Name",
to = "UniProtKB",
taxId = "9606"))
View(job_response)
job_id <- content(job_response)$jobId
# Wait for results
Sys.sleep(2)
# Get results
result_url <- paste0("https://rest.uniprot.org/idmapping/results/", job_id)
id_results <- GET(result_url) %>% content("text") %>% fromJSON()
# Extract accessions
accessions <- id_results$results$to$primaryAccession
################################################################################
### Title: String to Uniprot Protein ID Crosswalk
### Author: Daniel Posmik (daniel_posmik@brown.edu)
################################################################################
# Setup ========================================================================
# Environment
library(bio3d)
library(smacof)
library(readr)
library(tidyverse)
library(rbioapi)
library(httr)
library(jsonlite)
# Read in file names
prot_dict <-
read_tsv("../../data/gao_shs27k_data/protein.SHS27k.sequences.dictionary.pro3.tsv",
col_names = c("string_id", "seq"))
# Uniprot Crosswalk ============================================================
# Remove species prefix for STRING API
proteins <- sub("^9606\\.", "", prot_dict$string_id)
# Query STRING API
url <- "https://string-db.org/api/json/get_string_ids"
response <- POST(url,
body = list(identifiers = paste(proteins, collapse = "\n"),
species = 9606,
limit = 1))
# Parse results
prot_xwalk <- content(response, "text") %>% fromJSON()
# Get UniProt Accession IDs ====================================================
# Query UniProt API to map gene names to accession IDs
uniprot_url <- "https://rest.uniprot.org/idmapping/run"
job_response <- POST(uniprot_url,
body = list(ids = paste(prot_xwalk$preferredName, collapse = ","),
from = "Gene_Name",
to = "UniProtKB",
taxId = "9606"))
job_id <- content(job_response)$jobId
# Wait for results
Sys.sleep(5)
# Get results
result_url <- paste0("https://rest.uniprot.org/idmapping/results/", job_id)
id_results <- GET(result_url) %>% content("text") %>% fromJSON()
# Add accessions to crosswalk
prot_xwalk <- prot_xwalk %>%
left_join(
data.frame(
preferredName = id_results$results$from,
uniprot_accession = id_results$results$to$primaryAccession
),
by = "preferredName"
)
rm(list=ls())
# Read in crosswalk
prot_xwalk <- read_csv("../../output/proteins-mds/prot_crosswalk.csv")
View(prot_xwalk)
# Read in file names
prot_dict <-
read_tsv("../../data/gao_shs27k_data/protein.SHS27k.sequences.dictionary.pro3.tsv",
col_names = c("string_id", "seq"))
View(prot_dict)
test <- read.delim("/Users/posmikdc/Downloads/HUMAN_9606_idmapping_selected.tab",
header = FALSE)
View(test)
View(prot_dict)
test <- read.delim("/Users/posmikdc/Downloads/HUMAN_9606_idmapping.dat",
header = FALSE)
# Download idmapping file for human proteins
url <- "https://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/idmapping/by_organism/HUMAN_9606_idmapping_selected.tab.gz"
download.file(url, "HUMAN_9606_idmapping.tab.gz")
# Read the mapping file
id_mapping <- read.delim("HUMAN_9606_idmapping.tab.gz", header = FALSE)
View(id_mapping)
# Add column names (based on UniProt idmapping format)
colnames(id_mapping) <- c("UniProtKB_AC", "UniProtKB_ID", "GeneID", "RefSeq",
"GI", "PDB", "GO", "UniRef100", "UniRef90", "UniRef50",
"UniParc", "PIR", "NCBI_taxon", "MIM", "UniGene",
"PubMed", "EMBL", "EMBL_CDS", "Ensembl", "Ensembl_TRS",
"Ensembl_PRO", "Additional_PubMed")
# Now map your STRING proteins to UniProt accessions
prot_xwalk <- prot_xwalk %>%
left_join(
id_mapping %>%
filter(grepl("9606\\.ENSP", Ensembl_PRO)) %>%
select(UniProtKB_AC, Ensembl_PRO),
by = c("queryItem" = "Ensembl_PRO")
) %>%
rename(uniprot_accession = UniProtKB_AC)
View(prot_xwalk)
# Download and read idmapping file
url <- "https://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/idmapping/by_organism/HUMAN_9606_idmapping_selected.tab.gz"
download.file(url, "HUMAN_9606_idmapping.tab.gz")
id_mapping <- read.delim("HUMAN_9606_idmapping.tab.gz", header = FALSE)
colnames(id_mapping) <- c("UniProtKB_AC", "UniProtKB_ID", "GeneID", "RefSeq",
"GI", "PDB", "GO", "UniRef100", "UniRef90", "UniRef50",
"UniParc", "PIR", "NCBI_taxon", "MIM", "UniGene",
"PubMed", "EMBL", "EMBL_CDS", "Ensembl", "Ensembl_TRS",
"Ensembl_PRO", "Additional_PubMed")
# Split multiple ENSP IDs and create one row per ENSP
id_mapping_clean <- id_mapping %>%
select(UniProtKB_AC, Ensembl_PRO) %>%
filter(Ensembl_PRO != "") %>%
separate_rows(Ensembl_PRO, sep = "; ") %>%
mutate(Ensembl_PRO = sub("\\..*", "", Ensembl_PRO))  # Remove version numbers
View(id_mapping_clean)
# Join with your crosswalk
prot_xwalk <- prot_xwalk %>%
left_join(
id_mapping_clean,
by = c("queryItem" = "Ensembl_PRO")
) %>%
rename(uniprot_accession = UniProtKB_AC)
################################################################################
### Title: String to Uniprot Protein ID Crosswalk
### Author: Daniel Posmik (daniel_posmik@brown.edu)
################################################################################
# Setup ========================================================================
# Environment
#install.packages(c("bio3d", "smacof", "rbioapi"))
library(bio3d)
library(smacof)
library(readr)
library(tidyverse)
library(rbioapi)
library(httr)
library(jsonlite)
#setwd("/Users/posmikdc/Documents/brown/classes/year2/fall25/csci2952g-dlgenomics/csci2952g-paper/code/proteins-mds")
# Read in file names
prot_dict <-
read_tsv("../../data/gao_shs27k_data/protein.SHS27k.sequences.dictionary.pro3.tsv",
col_names = c("string_id", "seq"))
# Uniprot Crosswalk ============================================================
# Remove species prefix for STRING API
proteins <- sub("^9606\\.", "", prot_dict$string_id)
# Query STRING API
url <- "https://string-db.org/api/json/get_string_ids"
response <- POST(url,
body = list(identifiers = paste(proteins, collapse = "\n"),
species = 9606,
limit = 1))
# Parse results
prot_xwalk <- content(response, "text") %>% fromJSON()
# Join with your crosswalk
prot_xwalk <- prot_xwalk %>%
left_join(
id_mapping_clean,
by = c("queryItem" = "Ensembl_PRO")
) %>%
rename(uniprot_accession = UniProtKB_AC)
View(prot_xwalk)
rm(list=ls())
# Setup ========================================================================
# Environment
#install.packages(c("bio3d", "smacof", "rbioapi"))
library(bio3d)
library(smacof)
library(readr)
library(tidyverse)
library(rbioapi)
library(httr)
library(jsonlite)
# Read in file names
prot_dict <-
read_tsv("../../data/gao_shs27k_data/protein.SHS27k.sequences.dictionary.pro3.tsv",
col_names = c("string_id", "seq"))
# STRING to Gene Name Mapping ==================================================
# Remove species prefix (9606.) for STRING API
proteins <- sub("^9606\\.", "", prot_dict$string_id)
# Query STRING API to get gene names and Ensembl protein IDs
url <- "https://string-db.org/api/json/get_string_ids"
response <- POST(url,
body = list(identifiers = paste(proteins, collapse = "\n"),
species = 9606,
limit = 1))
# Parse STRING API results
prot_xwalk <- content(response, "text") %>% fromJSON()
# UniProt ID Mapping ===========================================================
# Download UniProt idmapping file for human proteins
url <- "https://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/idmapping/by_organism/HUMAN_9606_idmapping_selected.tab.gz"
download.file(url, "HUMAN_9606_idmapping.tab.gz")
# Read idmapping file and add column names
id_mapping <- read.delim("HUMAN_9606_idmapping.tab.gz", header = FALSE)
colnames(id_mapping) <- c("UniProtKB_AC", "UniProtKB_ID", "GeneID", "RefSeq",
"GI", "PDB", "GO", "UniRef100", "UniRef90", "UniRef50",
"UniParc", "PIR", "NCBI_taxon", "MIM", "UniGene",
"PubMed", "EMBL", "EMBL_CDS", "Ensembl", "Ensembl_TRS",
"Ensembl_PRO", "Additional_PubMed")
# Clean idmapping: split multiple ENSP IDs and remove version numbers
id_mapping_clean <- id_mapping %>%
select(UniProtKB_AC, Ensembl_PRO) %>%
filter(Ensembl_PRO != "") %>%
separate_rows(Ensembl_PRO, sep = "; ") %>%
mutate(Ensembl_PRO = sub("\\..*", "", Ensembl_PRO))
# Join STRING results with UniProt accessions via Ensembl protein IDs
prot_xwalk <- prot_xwalk %>%
left_join(
id_mapping_clean,
by = c("queryItem" = "Ensembl_PRO")
) %>%
rename(uniprot_accession = UniProtKB_AC)
# Save Final Crosswalk =========================================================
write_csv(prot_xwalk, "../../output/proteins-mds/prot_crosswalk.csv")
View(prot_xwalk)
rm(list=ls())
# Setup ========================================================================
# Environment
#install.packages(c("bio3d", "smacof", "rbioapi"))
library(bio3d)
library(smacof)
library(readr)
library(tidyverse)
library(rbioapi)
library(httr)
library(jsonlite)
# Read in file names
prot_dict <-
read_tsv("../../data/gao_shs27k_data/protein.SHS27k.sequences.dictionary.pro3.tsv",
col_names = c("string_id", "seq"))
# STRING to Gene Name Mapping ==================================================
# Remove species prefix (9606.) for STRING API
proteins <- sub("^9606\\.", "", prot_dict$string_id)
# Query STRING API to get gene names and Ensembl protein IDs
url <- "https://string-db.org/api/json/get_string_ids"
response <- POST(url,
body = list(identifiers = paste(proteins, collapse = "\n"),
species = 9606,
limit = 1))
# Parse STRING API results
prot_xwalk <- content(response, "text") %>% fromJSON()
# UniProt ID Mapping ===========================================================
# Download UniProt idmapping file for human proteins
url <- "https://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/idmapping/by_organism/HUMAN_9606_idmapping_selected.tab.gz"
download.file(url, "../../data/prot-structure/HUMAN_9606_idmapping.tab.gz")
# Read idmapping file and add column names
id_mapping <- read.delim("../../data/prot-structure/HUMAN_9606_idmapping.tab.gz",
header = FALSE)
colnames(id_mapping) <- c("UniProtKB_AC", "UniProtKB_ID", "GeneID", "RefSeq",
"GI", "PDB", "GO", "UniRef100", "UniRef90", "UniRef50",
"UniParc", "PIR", "NCBI_taxon", "MIM", "UniGene",
"PubMed", "EMBL", "EMBL_CDS", "Ensembl", "Ensembl_TRS",
"Ensembl_PRO", "Additional_PubMed")
# Clean idmapping: split multiple ENSP IDs and remove version numbers
id_mapping_clean <- id_mapping %>%
select(UniProtKB_AC, Ensembl_PRO) %>%
filter(Ensembl_PRO != "") %>%
separate_rows(Ensembl_PRO, sep = "; ") %>%
mutate(Ensembl_PRO = sub("\\..*", "", Ensembl_PRO))
# Join STRING results with UniProt accessions via Ensembl protein IDs
prot_xwalk <- prot_xwalk %>%
left_join(
id_mapping_clean,
by = c("queryItem" = "Ensembl_PRO")
) %>%
rename(uniprot_accession = UniProtKB_AC)
# Save Final Crosswalk =========================================================
write_csv(prot_xwalk, "../../output/proteins-mds/prot_crosswalk.csv")
rm(list=ls())
# Setup ========================================================================
# Environment
#install.packages(c("bio3d", "smacof", "rbioapi"))
library(bio3d)
library(smacof)
library(readr)
library(tidyverse)
library(rbioapi)
library(httr)
library(jsonlite)
#setwd("/Users/posmikdc/Documents/brown/classes/year2/fall25/csci2952g-dlgenomics/csci2952g-paper/code/proteins-mds")
# Read in crosswalk
prot_xwalk <- read_csv("../../output/proteins-mds/prot_crosswalk.csv")
View(prot_xwalk)
# Obtain 3D protein files ======================================================
# Test with first 5 proteins (remove NAs)
test_prots <- prot_xwalk$uniprot_accession[!is.na(prot_xwalk$uniprot_accession)][1:5]
# Download AlphaFold PDB files
for(acc in test_prots) {
url <- paste0("https://alphafold.ebi.ac.uk/files/AF-", acc, "-F1-model_v4.pdb")
destfile <- paste0("../../data/prot-structure/prot-coords/", acc, ".pdb")
tryCatch({
download.file(url, destfile, quiet = TRUE)
cat("Downloaded:", acc, "\n")
}, error = function(e) {
cat("Failed:", acc, "\n")
})
}
test_prots
rm(list=ls())
# Setup ========================================================================
# Environment
#install.packages(c("bio3d", "smacof", "rbioapi"))
library(bio3d)
library(smacof)
library(readr)
library(tidyverse)
library(rbioapi)
library(httr)
library(jsonlite)
# Read in crosswalk
prot_xwalk <- read_csv("../../output/proteins-mds/prot_crosswalk.csv")
# Obtain 3D protein files ======================================================
# Test with first 5 proteins (remove NAs)
test_prots <- prot_xwalk$uniprot_accession[!is.na(prot_xwalk$uniprot_accession)][1:5]
# Download AlphaFold PDB files (version 6)
for(acc in test_prots) {
url <- paste0("https://alphafold.ebi.ac.uk/files/AF-", acc, "-F1-model_v6.pdb")
destfile <- paste0("../../data/prot-structure/prot-coords/", acc, ".pdb")
tryCatch({
download.file(url, destfile, quiet = TRUE)
cat("Downloaded:", acc, "\n")
}, error = function(e) {
cat("Failed:", acc, "\n")
})
}
# Read PDB file
Q15311 <- read.pdb("../../data/prot-structure/prot-coords/Q15311.pdb")
# Extract C-alpha coordinates
ca_coords <- matrix(Q15311$xyz[Q15311$calpha], ncol = 3, byrow = TRUE)
# Calculate distance matrix
Q15311_DistMat <- as.matrix(dist(ca_coords))
rm(list=ls())
# Setup ========================================================================
# Environment
#install.packages(c("bio3d", "smacof", "rbioapi"))
library(bio3d)
library(smacof)
library(readr)
library(tidyverse)
library(rbioapi)
library(httr)
library(jsonlite)
# Read in crosswalk
prot_xwalk <- read_csv("../../output/proteins-mds/prot_crosswalk.csv")
# Obtain 3D protein files ======================================================
# Create output directory
dir.create("../../data/prot-structure/prot-coords", showWarnings = FALSE, recursive = TRUE)
# Obtain 3D protein files ======================================================
# Get all non-NA accessions
all_prots <- prot_xwalk$uniprot_accession[!is.na(prot_xwalk$uniprot_accession)]
# Initialize download log
download_log <- data.frame(
uniprot_accession = character(),
status = character(),
url = character(),
stringsAsFactors = FALSE
)
# Download AlphaFold PDB files (version 6)
for(acc in all_prots) {
url <- paste0("https://alphafold.ebi.ac.uk/files/AF-", acc, "-F1-model_v6.pdb")
destfile <- paste0("../../data/prot-structure/prot-coords/", acc, ".pdb")
result <- tryCatch({
download.file(url, destfile, quiet = TRUE)
cat("Downloaded:", acc, "\n")
"success"
}, error = function(e) {
cat("Failed:", acc, "\n")
"failed"
})
# Log result
download_log <- rbind(download_log,
data.frame(uniprot_accession = acc,
status = result,
url = url))
}
# Save download log
write_csv(download_log, "../../data/prot-structure/prot-coords/_pdb_download_log.csv")
# Print summary
cat("\nDownload Summary:\n")
cat("Successful:", sum(download_log$status == "success"), "\n")
cat("Failed:", sum(download_log$status == "failed"), "\n")
rm(list=ls())
# Setup ========================================================================
# Environment
#install.packages(c("bio3d", "smacof", "rbioapi"))
library(bio3d)
library(smacof)
library(readr)
# Setup ========================================================================
# Environment
#install.packages(c("bio3d", "smacof", "rbioapi"))
library(bio3d)
library(smacof)
library(readr)
library(tidyverse)
library(rbioapi)
library(httr)
library(jsonlite)
# Get list of available PDB files
pdb_files <- list.files("../../data/prot-structure/prot-coords",
pattern = "\\.pdb$",
full.names = TRUE)
prot_names <- sub("\\.pdb$", "", basename(pdb_files))
# Initialize MDS stress log
mds_log <- data.frame(
protein = character(),
stress = numeric(),
status = character(),
stringsAsFactors = FALSE
)
# MDS parameters
k <- 2  # Target dimension
# Process each protein =========================================================
for(i in seq_along(pdb_files)) {
prot_name <- prot_names[i]
cat("Processing:", prot_name, "(", i, "/", length(pdb_files), ")\n")
result <- tryCatch({
# Read PDB file
pdb <- read.pdb(pdb_files[i])
# Extract C-alpha coordinates
ca_coords <- matrix(pdb$xyz[pdb$calpha], ncol = 3, byrow = TRUE)
# Calculate distance matrix
dist_mat <- as.matrix(dist(ca_coords))
# Perform MDS
mds_result <- smacofSym(dist_mat, ndim = k, type = "ratio")
# Extract low-dimensional coordinates
low_dim_coords <- mds_result$conf
# Save coordinates to file
output_file <- paste0("../../output/proteins-mds/prots-mds/", prot_name, ".txt")
write.table(low_dim_coords, output_file, row.names = FALSE, col.names = FALSE)
# Log success
data.frame(protein = prot_name,
stress = mds_result$stress,
status = "success")
}, error = function(e) {
cat("  Failed:", prot_name, "-", e$message, "\n")
data.frame(protein = prot_name,
stress = NA,
status = paste0("failed: ", e$message))
})
mds_log <- rbind(mds_log, result)
}
# Save MDS stress log
write_csv(mds_log, "../../output/proteins-mds/prots-mds/_mds_stress_log.csv")
# Print summary
cat("\nMDS Summary:\n")
cat("Successful:", sum(mds_log$status == "success"), "\n")
cat("Failed:", sum(mds_log$status != "success"), "\n")
cat("Mean stress:", mean(mds_log$stress, na.rm = TRUE), "\n")
cat("Median stress:", median(mds_log$stress, na.rm = TRUE), "\n")
